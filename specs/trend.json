{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Monthly koala sightings (filtered by year and state).",
  "width": 900,
  "height": 300,

  "params": [
    {
      "name": "year_sel",
      "value": 2021,
      "bind": { "input": "range", "min": 2000, "max": 2025, "step": 1, "name": "Year " }
    },
    {
      "name": "state_sel",
      "value": "All",
      "bind": {
        "input": "select",
        "options": ["All","New South Wales","Queensland","Victoria","South Australia"],
        "name": " State "
      }
    }
  ],

  "data": { "url": "data/occ_koala_recent.csv" },

  "transform": [
    { "calculate": "toDate(datum.eventDate)", "as": "dt" },
    { "calculate": "year(datum.dt)", "as": "year" },

    { "filter": "isValid(datum.lon) && isValid(datum.lat)" },
    { "filter": "datum.lat >= -45 && datum.lat <= -10 && datum.lon >= 110 && datum.lon <= 155" },

    { "filter": "datum.year == year_sel" },
    { "filter": "state_sel == 'All' || datum.state == state_sel" },

    { "timeUnit": "month", "field": "dt", "as": "m" },
    { "aggregate": [{ "op": "count", "as": "sightings" }], "groupby": ["m"] },
    { "calculate": "timeFormat(datum.m, '%b')", "as": "month_name" }
  ],

  "mark": { "type": "line", "point": true },

  "encoding": {
    "x": {
      "field": "m",
      "type": "temporal",
      "title": "Month",
      "axis": { "labelExpr": "timeFormat(datum.value, '%b')" }
    },
    "y": {
      "field": "sightings",
      "type": "quantitative",
      "title": "Koala sightings",
      "axis": { "format": ",.0f" }
    },
    "tooltip": [
      { "field": "month_name", "type": "nominal", "title": "Month" },
      { "field": "sightings", "type": "quantitative", "title": "Sightings", "format": ",.0f" }
    ]
  },

  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 12 },
    "view": { "stroke": "transparent" }
  }
}
